<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Drafteo Online de Pokémon UNITE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, updateDoc, collection, query, where, getDocs, writeBatch, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURACIÓN DE FIREBASE (INTEGRADA) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBVBM0lEVF7oJwaIUYoEY2vc5eLXMPkw3I",
            authDomain: "simulador-unite.firebaseapp.com",
            projectId: "simulador-unite",
            storageBucket: "simulador-unite.firebasestorage.app",
            messagingSenderId: "562805600014",
            appId: "1:562805600014:web:ae9ad79882a5afb477b15f",
            measurementId: "G-YMCV11HQH0"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        window.app = { db, auth, doc, onSnapshot, setDoc, getDoc, updateDoc, collection, query, where, getDocs, writeBatch, signInAnonymously, onAuthStateChanged, deleteDoc, serverTimestamp, signInWithCustomToken };
    </script>
    <style>
        @keyframes aurora { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        body { font-family: 'Exo 2', sans-serif; background-color: #0C0C1E; color: #e0e0e0; position: relative; }
        body::before {
            content: ''; position: fixed; width: 150vmax; height: 150vmax; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, #3b82f6 0%, transparent 30%), radial-gradient(circle, #ec4899 0%, transparent 30%), radial-gradient(circle, #8b5cf6 0%, transparent 30%);
            background-blend-mode: screen; filter: blur(100px); opacity: 0.3; animation: aurora 25s linear infinite; z-index: -1;
        }
        .modern-panel { background: rgba(12, 12, 30, 0.5); -webkit-backdrop-filter: blur(12px); backdrop-filter: blur(12px); border: 1px solid #22253b; border-radius: 1.5rem; }
        .pokemon-card { transition: all 0.2s ease-in-out; cursor: pointer; border: 2px solid transparent; border-radius: 1rem; }
        .pokemon-card.selected { transform: translateY(-4px); border-color: #38bdf8; box-shadow: 0 0 20px rgba(56, 189, 248, 0.7); }
        .pokemon-card.disabled { filter: grayscale(100%) opacity(0.4); pointer-events: none; }
        .bg-role-Attacker { background: radial-gradient(circle at top right, rgba(239, 68, 68, 0.5), rgba(22, 25, 59, 0.5)); }
        .bg-role-Defender { background: radial-gradient(circle at top right, rgba(34, 197, 94, 0.5), rgba(22, 25, 59, 0.5)); }
        .bg-role-Speedster { background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.5), rgba(22, 25, 59, 0.5)); }
        .bg-role-All-Rounder { background: radial-gradient(circle at top right, rgba(168, 85, 247, 0.5), rgba(22, 25, 59, 0.5)); }
        .bg-role-Supporter { background: radial-gradient(circle at top right, rgba(234, 179, 8, 0.5), rgba(22, 25, 59, 0.5)); }
        .main-title { background: linear-gradient(90deg, #67e8f9, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .styled-button { background-image: linear-gradient(to right, #0ea5e9 0%, #a855f7 50%, #d946ef 100%); background-size: 200% auto; transition: all 0.3s; }
        .styled-button:hover:not(:disabled) { background-position: right center; }
        .styled-button:disabled { background-image: none; background-color: #374151; cursor: not-allowed; }
        .secondary-button { background-color: rgba(30, 41, 59, 0.5); border: 1px solid #334155; transition: all 0.2s; }
        .secondary-button:hover { background-color: rgba(51, 65, 85, 0.7); border-color: #475569; }
        .team-slot.picking { transform: scale(1.03); box-shadow: 0 0 20px, 0 0 10px inset; border-color: #facc15; }
    </style>
</head>
<body class="p-2 sm:p-4">

    <div id="draft-simulator" class="w-full max-w-screen-xl mx-auto flex flex-col h-screen relative z-10">
        <header class="text-center mb-4 shrink-0">
            <h1 class="text-4xl sm:text-5xl font-extrabold main-title">SIMULADOR DE DRAFTEO ONLINE</h1>
            <p class="text-slate-300 font-semibold">Creado por: <span class="font-bold text-cyan-400">antuan</span></p>
        </header>

        <div id="lobby-screen" class="flex-grow flex flex-col justify-center items-center gap-6">
            <div class="modern-panel p-8 rounded-2xl text-center w-full max-w-md">
                <h2 class="text-2xl font-bold mb-4">Ingresa tu nombre de usuario</h2>
                <input type="text" id="username-input" class="w-full bg-slate-800 text-white p-3 rounded-lg text-center" placeholder="Tu nombre...">
            </div>
            <button id="find-match-button" class="styled-button text-white font-bold py-4 px-8 rounded-2xl text-xl">BUSCAR PARTIDA ONLINE</button>
        </div>
        
        <div id="draft-container" class="hidden flex-grow flex-col min-h-0">
            <!-- El contenido del draft se generará dinámicamente aquí -->
        </div>
    </div>
    
    <template id="draft-template">
        <div id="top-bar" class="flex flex-col md:flex-row justify-between items-center mb-4 px-4 shrink-0">
            <div class="w-full md:w-1/3 flex justify-center md:justify-start gap-2 order-2 md:order-1 my-2 md:my-0">
                <div id="purple-bans" class="flex justify-center gap-2"></div>
            </div>
            <div id="timer-container" class="modern-panel py-2 px-6 flex items-center gap-4 order-1 md:order-2">
                <div id="timer" class="text-5xl font-bold text-white">--</div>
            </div>
            <div class="w-full md:w-1/3 flex justify-center md:justify-end gap-2 order-3">
                <div id="orange-bans" class="flex justify-center gap-2"></div>
            </div>
        </div>
        <div class="flex-grow flex flex-col lg:flex-row gap-4 min-h-0">
            <aside id="purple-aside" class="w-full lg:w-1/4 p-4 modern-panel flex flex-col">
                <h2 id="purple-player-name" class="text-2xl font-bold text-center mb-4 text-purple-400"></h2>
                <div id="purple-team" class="space-y-3 flex-grow"></div>
            </aside>
            <section id="main-section" class="flex-grow flex flex-col min-h-0">
                <div id="draft-status" class="w-full text-center p-3 mb-4 rounded-lg font-extrabold text-xl sm:text-2xl transition-all duration-300 modern-panel shrink-0"></div>
                <div id="pokemon-grid" class="flex-grow p-3 grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-3 modern-panel overflow-y-auto"></div>
                <button id="confirm-button" class="w-full max-w-xs mx-auto styled-button font-bold py-3 px-4 text-lg rounded-xl mt-4 hidden">CONFIRMAR</button>
            </section>
            <aside id="orange-aside" class="w-full lg:w-1/4 p-4 modern-panel flex flex-col">
                <h2 id="orange-player-name" class="text-2xl font-bold text-center mb-4 text-orange-400"></h2>
                <div id="orange-team" class="space-y-3 flex-grow"></div>
            </aside>
        </div>
        <div class="mt-4 flex flex-col sm:flex-row gap-4 shrink-0">
            <button id="exit-button" class="w-full sm:w-1/2 secondary-button font-bold py-3 px-4 rounded-lg">SALIR DE LA PARTIDA</button>
        </div>
    </template>

    <script type="module">
        const { db, auth, doc, onSnapshot, setDoc, getDoc, updateDoc, collection, query, where, getDocs, writeBatch, deleteDoc, signInAnonymously, onAuthStateChanged, serverTimestamp } = window.app;

        let localPlayer = {};
        let currentUnsubscribe;
        let timerInterval;
        let gameState = {};

        const dom = {
            lobbyScreen: document.getElementById('lobby-screen'),
            draftContainer: document.getElementById('draft-container'),
            findMatchButton: document.getElementById('find-match-button'),
            usernameInput: document.getElementById('username-input'),
        };

        const pokemonData = [
                { id: "venusaur", name: "Venusaur", role: "Attacker"}, { id: "charizard", name: "Charizard", role: "All-Rounder"}, { id: "blastoise", name: "Blastoise", role: "Defender"}, { id: "pikachu", name: "Pikachu", role: "Attacker"}, { id: "clefable", name: "Clefable", role: "Supporter"}, { id: "alolan-ninetales", name: "A. Ninetales", role: "Attacker"}, { id: "wigglytuff", name: "Wigglytuff", role: "Supporter"}, { id: "machamp", name: "Machamp", role: "All-Rounder"}, { id: "slowbro", name: "Slowbro", role: "Defender"}, { id: "gengar", name: "Gengar", role: "Speedster"}, { id: "mr-mime", name: "Mr. Mime", role: "Supporter"}, { id: "gyarados", name: "Gyarados", role: "All-Rounder"}, { id: "snorlax", name: "Snorlax", role: "Defender"}, { id: "dragonite", name: "Dragonite", role: "All-Rounder"}, { id: "mewtwo-x", name: "Mewtwo X", role: "All-Rounder"}, { id: "mewtwo-y", name: "Mewtwo Y", role: "Attacker"}, { id: "mew", name: "Mew", role: "Attacker"}, { id: "azumarill", name: "Azumarill", role: "All-Rounder"}, { id: "espeon", name: "Espeon", role: "Attacker"}, { id: "umbreon", name: "Umbreon", role: "Defender"}, { id: "scizor", name: "Scizor", role: "All-Rounder"}, { id: "blissey", name: "Blissey", role: "Supporter"}, { id: "tyranitar", name: "Tyranitar", role: "All-Rounder"}, { id: "gardevoir", name: "Gardevoir", role: "Attacker"}, { id: "sableye", name: "Sableye", role: "Supporter"}, { id: "absol", name: "Absol", role: "Speedster"}, { id: "metagross", name: "Metagross", role: "All-Rounder"}, { id: "garchomp", name: "Garchomp", role: "All-Rounder"}, { id: "lucario", name: "Lucario", role: "All-Rounder"}, { id: "leafeon", name: "Leafeon", role: "Speedster"}, { id: "glaceon", name: "Glaceon", role: "Attacker"}, { id: "crustle", name: "Crustle", role: "Defender"}, { id: "greninja", name: "Greninja", role: "Attacker"}, { id: "talonflame", name: "Talonflame", role: "Speedster"}, { id: "aegislash", name: "Aegislash", role: "All-Rounder"}, { id: "sylveon", name: "Sylveon", role: "Attacker"}, { id: "goodra", name: "Goodra", role: "Defender"}, { id: "trevenant", name: "Trevenant", role: "Defender"}, { id: "hoopa", name: "Hoopa", role: "Supporter"}, { id: "decidueye", name: "Decidueye", role: "Attacker"}, { id: "tsareena", name: "Tsareena", role: "All-Rounder"}, { id: "comfey", name: "Comfey", role: "Supporter"}, { id: "cinderace", name: "Cinderace", role: "Attacker"}, { id: "inteleon", name: "Inteleon", role: "Attacker"}, { id: "eldegoss", name: "Eldegoss", role: "Supporter"}, { id: "cramorant", name: "Cramorant", role: "Attacker"}, { id: "duraludon", name: "Duraludon", role: "Attacker"}, { id: "zeraora", name: "Zeraora", role: "Speedster"}, { id: "lapras", name: "Lapras", role: "Defender"}, { id: "chandelure", name: "Chandelure", role: "Attacker"}, { id: "dodrio", name: "Dodrio", role: "Speedster"}, { id: "buzzwole", name: "Buzzwole", role: "All-Rounder"}, { id: "zacian", name: "Zacian", role: "All-Rounder"}, { id: "urshifu", name: "Urshifu", role: "All-Rounder"}, { id: "dragapult", name: "Dragapult", role: "Attacker"}, { id: "mamoswine", name: "Mamoswine", role: "Defender"}, { id: "delphox", name: "Delphox", role: "Attacker"}, { id: "zoroark", name: "Zoroark", role: "Speedster"}, { id: "mimikyu", name: "Mimikyu", role: "All-Rounder"}, { id: "falinks", name: "Falinks", role: "All-Rounder"}, { id: "blaziken", name: "Blaziken", role: "All-Rounder"}, { id: "meowscarada", name: "Meowscarada", role: "Speedster"}, { id: "miraidon", name: "Miraidon", role: "Attacker"}, { id: "ceruledge", name: "Ceruledge", role: "All-Rounder"}, { id: "armarouge", name: "Armarouge", role: "Attacker"}, { id: "alcremie", name: "Alcremie", role: "Supporter"}, { id: "ho-oh", name: "Ho-Oh", role: "Defender"}, { id: "alolan-raichu", name: "A. Raichu", role: "Attacker"}, { id: "darkrai", name: "Darkrai", role: "Speedster"}, { id: "greedent", name: "Greedent", role: "Defender"}, { id: "suicune", name: "Suicune", role: "All-Rounder"}, { id: "tinkaton", name: "Tinkaton", role: "All-Rounder"}
            ].sort((a, b) => a.name.localeCompare(b.name));
            
        async function findMatch() {
            const username = dom.usernameInput.value.trim();
            if (!username) { alert("Por favor, ingresa un nombre de usuario."); return; }
            
            dom.findMatchButton.disabled = true;
            dom.findMatchButton.textContent = "Buscando oponente...";

            await onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const userId = user.uid;
                    const q = query(collection(db, "matchmakingQueue"), where("status", "==", "waiting"));
                    const querySnapshot = await getDocs(q);

                    const opponentDoc = querySnapshot.docs.find(doc => doc.id !== userId);
                    
                    if (opponentDoc) {
                        const opponent = opponentDoc.data();
                        const gameId = Math.random().toString(36).substring(2, 10);
                        const gameRef = doc(db, "games", gameId);
                        const teams = ['PURPLE', 'ORANGE'];
                        const localPlayerTeam = teams[Math.floor(Math.random() * 2)];
                        const opponentTeam = localPlayerTeam === 'PURPLE' ? 'ORANGE' : 'PURPLE';
                        
                        const initialData = { 
                            phase: 'BAN', turn: 'PURPLE', purpleBans: [], orangeBans: [], purplePicks: [], orangePicks: [], pickOrderIndex: 0, banOrderIndex: 0, selectedPokemon: {PURPLE: null, ORANGE: null},
                            players: {
                                [userId]: { name: username, team: localPlayerTeam },
                                [opponent.userId]: { name: opponent.username, team: opponentTeam }
                            },
                            gameId: gameId,
                            lastUpdate: serverTimestamp()
                        };
                        await setDoc(gameRef, initialData);
                        await updateDoc(doc(db, "matchmakingQueue", opponent.userId), { status: "matched", gameId: gameId });
                        startGame(gameId, {id: userId, name: username, team: localPlayerTeam});
                    } else {
                        const userQueueRef = doc(db, "matchmakingQueue", userId);
                        await setDoc(userQueueRef, { userId, username, status: "waiting", timestamp: serverTimestamp() });
                        
                        currentUnsubscribe = onSnapshot(userQueueRef, async (docSnap) => {
                            const data = docSnap.data();
                            if (data && data.status === 'matched' && data.gameId) {
                                if (currentUnsubscribe) currentUnsubscribe();
                                const gameDoc = await getDoc(doc(db, "games", data.gameId));
                                if (gameDoc.exists()) {
                                    const playerInfo = gameDoc.data().players[userId];
                                    await deleteDoc(userQueueRef);
                                    startGame(data.gameId, {id: userId, name: username, team: playerInfo.team });
                                }
                            }
                        });
                    }
                }
            });

            if (!auth.currentUser) {
                 await signInAnonymously(auth);
            }
        }
        
        // ... The rest of the functions would be here, but are omitted for this example.
        // The full implementation would require a lot more code for UI updates and Firebase writes.

        dom.findMatchButton.addEventListener('click', findMatch);
    </script>
</body>
</html>